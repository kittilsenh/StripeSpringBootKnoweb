<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stripe Payment Gateway</title>
  <style>
    /* Basic styling for the form */
    body {
      font-family: Arial, sans-serif;
      background-color: #f6f6f6;
      padding: 50px;
    }
    .container {
      max-width: 500px;
      padding: 20px;
      background-color: #fff;
      margin: auto;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }
    h2 {
      text-align: center;
    }
    #card-element {
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 4px;
    }
    #card-errors {
      color: red;
      margin-top: 10px;
    }
    button {
      background-color: #6772e5;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
      font-size: 16px;
    }
    button:disabled {
      background-color: #aab7c4;
      cursor: not-allowed;
    }
    .success {
      color: green;
      margin-top: 20px;
      text-align: center;
    }
  </style>
  <!-- Stripe.js -->
  <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
<div class="container">
  <h2>Stripe Payment Gateway</h2>
  <p>Use the form below to make a test payment.</p>
  <form id="payment-form">
    <div id="card-element">
      <!-- Stripe Elements will create input here -->
    </div>
    <div id="card-errors" role="alert"></div>
    <button id="submit-button">Pay $50.00</button>
  </form>
  <div class="success" id="success-message"></div>
</div>

<script>
  // Replace with your own publishable key
  const stripe = Stripe('pk_test_51Ot6a6F30zvOkJGCS0GTYbkzirFVbRJqPMnkfaH3XsTpniIdmxZhnwm48qqJtzjrSY7u366FkNCjcHQlZWk0FSC100euMGM77q');

  const elements = stripe.elements();
  const style = {
    base: {
      color: "#32325d",
      fontFamily: '"Helvetica Neue", Helvetica, sans-serif',
      fontSmoothing: "antialiased",
      fontSize: "16px",
      "::placeholder": {
        color: "#aab7c4"
      }
    },
    invalid: {
      color: "#fa755a",
      iconColor: "#fa755a"
    }
  };

  const card = elements.create("card", { style: style });
  card.mount("#card-element");

  // Handle real-time validation errors from the card Element.
  card.on('change', ({error}) => {
    const displayError = document.getElementById('card-errors');
    if (error) {
      displayError.textContent = error.message;
    } else {
      displayError.textContent = '';
    }
  });

  // Handle form submission
  const form = document.getElementById('payment-form');
  const submitButton = document.getElementById('submit-button');
  const successMessage = document.getElementById('success-message');

  form.addEventListener('submit', async (event) => {
    event.preventDefault();
    submitButton.disabled = true;

    // Create PaymentIntent on the server
    const response = await fetch('/api/payment/create-payment-intent', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({}), // You can pass additional data here if needed
    });

    const { clientSecret, error: backendError } = await response.json();

    if (backendError) {
      displayError(backendError);
      submitButton.disabled = false;
      return;
    }

    // Confirm the card payment
    const { paymentIntent, error: stripeError } = await stripe.confirmCardPayment(clientSecret, {
      payment_method: {
        card: card,
      }
    });

    if (stripeError) {
      displayError(stripeError.message);
      submitButton.disabled = false;
    } else if (paymentIntent.status === 'succeeded') {
      successMessage.textContent = 'Payment successful!';
      form.reset();
      card.clear();
      submitButton.disabled = false;
    }
  });

  function displayError(message) {
    const displayError = document.getElementById('card-errors');
    displayError.textContent = message;
  }
</script>
</body>
</html>
